
{% extends "base.html" %}

{% block content %}
<div class="history-container">
    <!-- Header -->
    <div class="history-header">
        <h1><i class="fas fa-history"></i> Restoration History</h1>
        <p class="subtitle">All your restored memories in one place</p>
        
        <div class="stats-overview">
            <div class="stat-card">
                <div class="stat-icon total">
                    <i class="fas fa-images"></i>
                </div>
                <div class="stat-content">
                    <h3 id="totalRestorations">12</h3>
                    <p>Total Restorations</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon quick">
                    <i class="fas fa-bolt"></i>
                </div>
                <div class="stat-content">
                    <h3 id="quickRestorations">8</h3>
                    <p>Quick Clean</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon deep">
                    <i class="fas fa-microscope"></i>
                </div>
                <div class="stat-content">
                    <h3 id="deepRestorations">4</h3>
                    <p>Deep Restorations</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon storage">
                    <i class="fas fa-hdd"></i>
                </div>
                <div class="stat-content">
                    <h3>47.3 MB</h3>
                    <p>Storage Used</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Controls -->
    <div class="history-controls">
        <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" id="searchInput" placeholder="Search restorations...">
            <button class="clear-search" id="clearSearch">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="filter-controls">
            <div class="filter-group">
                <label for="modelFilter">
                    <i class="fas fa-filter"></i> Filter by Model
                </label>
                <select id="modelFilter">
                    <option value="all">All Models</option>
                    <option value="quick">Quick Clean</option>
                    <option value="deep">Deep Restoration</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="sortFilter">
                    <i class="fas fa-sort"></i> Sort by
                </label>
                <select id="sortFilter">
                    <option value="newest">Newest First</option>
                    <option value="oldest">Oldest First</option>
                    <option value="name">Name (A-Z)</option>
                </select>
            </div>
            
            <button class="btn secondary-btn" id="clearHistory">
                <i class="fas fa-trash-alt"></i> Clear History
            </button>
        </div>
    </div>

    <!-- History Grid -->
    <div class="history-grid" id="historyGrid">
        <!-- Sample restoration cards (would be populated by backend) -->
        <div class="restoration-card" data-model="quick" data-date="2024-01-15">
            <div class="card-header">
                <div class="card-badge quick">
                    <i class="fas fa-bolt"></i>
                    Quick Clean
                </div>
                <div class="card-actions">
                    <button class="action-btn" title="Download">
                        <i class="fas fa-download"></i>
                    </button>
                    <button class="action-btn" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
            
            <div class="image-comparison-small">
                <div class="image-before">
                    <img src="https://via.placeholder.com/200x150/222831/DFD0B8?text=Before" alt="Before">
                    <span class="image-label">Before</span>
                </div>
                <div class="image-after">
                    <img src="https://via.placeholder.com/200x150/393E46/DFD0B8?text=After" alt="After">
                    <span class="image-label">After</span>
                </div>
            </div>
            
            <div class="card-content">
                <h4 class="card-title">Family Portrait 1985</h4>
                <p class="card-description">Restored scratches and improved contrast</p>
                
                <div class="card-details">
                    <div class="detail">
                        <i class="fas fa-calendar"></i>
                        <span>Jan 15, 2024</span>
                    </div>
                    <div class="detail">
                        <i class="fas fa-clock"></i>
                        <span>18 seconds</span>
                    </div>
                    <div class="detail">
                        <i class="fas fa-expand"></i>
                        <span>1280×960</span>
                    </div>
                </div>
                
                <div class="quality-score">
                    <div class="score-label">Quality Score</div>
                    <div class="score-bar">
                        <div class="score-fill" style="width: 85%"></div>
                    </div>
                    <div class="score-value">85%</div>
                </div>
            </div>
            
            <div class="card-footer">
                <button class="download-btn" onclick="downloadRestoration(this)">
                    <i class="fas fa-download"></i>
                    Download Again
                </button>
                <button class="view-btn" onclick="viewRestoration(this)">
                    <i class="fas fa-eye"></i>
                    View Details
                </button>
            </div>
        </div>
        
        <!-- Add more sample cards -->
        <div class="restoration-card" data-model="deep" data-date="2024-01-14">
            <div class="card-header">
                <div class="card-badge deep">
                    <i class="fas fa-microscope"></i>
                    Deep Restoration
                </div>
                <div class="card-actions">
                    <button class="action-btn" title="Download">
                        <i class="fas fa-download"></i>
                    </button>
                    <button class="action-btn" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
            
            <div class="image-comparison-small">
                <div class="image-before">
                    <img src="https://via.placeholder.com/200x150/222831/DFD0B8?text=Before" alt="Before">
                    <span class="image-label">Before</span>
                </div>
                <div class="image-after">
                    <img src="https://via.placeholder.com/200x150/393E46/DFD0B8?text=After" alt="After">
                    <span class="image-label">After</span>
                </div>
            </div>
            
            <div class="card-content">
                <h4 class="card-title">Wedding Photo 1972</h4>
                <p class="card-description">Color restoration and tear repair</p>
                
                <div class="card-details">
                    <div class="detail">
                        <i class="fas fa-calendar"></i>
                        <span>Jan 14, 2024</span>
                    </div>
                    <div class="detail">
                        <i class="fas fa-clock"></i>
                        <span>42 seconds</span>
                    </div>
                    <div class="detail">
                        <i class="fas fa-expand"></i>
                        <span>1600×1200</span>
                    </div>
                </div>
                
                <div class="quality-score">
                    <div class="score-label">Quality Score</div>
                    <div class="score-bar">
                        <div class="score-fill" style="width: 92%"></div>
                    </div>
                    <div class="score-value">92%</div>
                </div>
            </div>
            
            <div class="card-footer">
                <button class="download-btn" onclick="downloadRestoration(this)">
                    <i class="fas fa-download"></i>
                    Download Again
                </button>
                <button class="view-btn" onclick="viewRestoration(this)">
                    <i class="fas fa-eye"></i>
                    View Details
                </button>
            </div>
        </div>
        
        <!-- Empty state -->
        <div class="empty-state" id="emptyState" style="display: none;">
            <div class="empty-icon">
                <i class="fas fa-box-open"></i>
            </div>
            <h3>No Restorations Yet</h3>
            <p>Your restoration history will appear here after you process some images.</p>
            <button class="btn" onclick="window.location.href='{{ url_for('home') }}'">
                <i class="fas fa-plus-circle"></i>
                Start Your First Restoration
            </button>
        </div>
    </div>

    <!-- Pagination -->
    <div class="pagination" id="pagination">
        <button class="page-btn" id="prevPage" disabled>
            <i class="fas fa-chevron-left"></i> Previous
        </button>
        
        <div class="page-numbers">
            <span class="page-number active">1</span>
            <span class="page-number">2</span>
            <span class="page-number">3</span>
            <span class="page-dots">...</span>
            <span class="page-number">5</span>
        </div>
        
        <button class="page-btn" id="nextPage">
            Next <i class="fas fa-chevron-right"></i>
        </button>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
        <button class="btn secondary-btn" onclick="window.location.href='{{ url_for('home') }}'">
            <i class="fas fa-arrow-left"></i> Back to Home
        </button>
        <button class="btn" onclick="exportHistory()">
            <i class="fas fa-file-export"></i> Export History
        </button>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Sample data for demonstration
    const sampleRestorations = [
        {
            id: 1,
            title: "Family Portrait 1985",
            description: "Restored scratches and improved contrast",
            model: "quick",
            date: "2024-01-15",
            time: "18 seconds",
            resolution: "1280×960",
            quality: 85
        },
        {
            id: 2,
            title: "Wedding Photo 1972",
            description: "Color restoration and tear repair",
            model: "deep",
            date: "2024-01-14",
            time: "42 seconds",
            resolution: "1600×1200",
            quality: 92
        },
        {
            id: 3,
            title: "School Photo 1990",
            description: "Removed stains and enhanced details",
            model: "quick",
            date: "2024-01-12",
            time: "22 seconds",
            resolution: "1024×768",
            quality: 78
        },
        {
            id: 4,
            title: "Vacation Photo 1965",
            description: "Complete colorization and restoration",
            model: "deep",
            date: "2024-01-10",
            time: "56 seconds",
            resolution: "1400×1050",
            quality: 95
        }
    ];

    // Update statistics
    function updateStats() {
        const total = sampleRestorations.length;
        const quick = sampleRestorations.filter(r => r.model === 'quick').length;
        const deep = sampleRestorations.filter(r => r.model === 'deep').length;
        
        document.getElementById('totalRestorations').textContent = total;
        document.getElementById('quickRestorations').textContent = quick;
        document.getElementById('deepRestorations').textContent = deep;
    }

    // Filter and search functionality
    const searchInput = document.getElementById('searchInput');
    const modelFilter = document.getElementById('modelFilter');
    const sortFilter = document.getElementById('sortFilter');
    const clearSearch = document.getElementById('clearSearch');
    const historyGrid = document.getElementById('historyGrid');
    const emptyState = document.getElementById('emptyState');
    
    function filterRestorations() {
        const searchTerm = searchInput.value.toLowerCase();
        const modelValue = modelFilter.value;
        const sortValue = sortFilter.value;
        
        const cards = document.querySelectorAll('.restoration-card');
        let visibleCount = 0;
        
        cards.forEach(card => {
            const title = card.querySelector('.card-title').textContent.toLowerCase();
            const description = card.querySelector('.card-description').textContent.toLowerCase();
            const model = card.dataset.model;
            
            const matchesSearch = !searchTerm || 
                title.includes(searchTerm) || 
                description.includes(searchTerm);
            
            const matchesModel = modelValue === 'all' || model === modelValue;
            
            if (matchesSearch && matchesModel) {
                card.style.display = 'block';
                visibleCount++;
            } else {
                card.style.display = 'none';
            }
        });
        
        // Show empty state if no cards visible
        if (visibleCount === 0) {
            emptyState.style.display = 'block';
        } else {
            emptyState.style.display = 'none';
        }
        
        // Update count in pagination
        document.querySelector('.page-numbers .page-number.active').textContent = '1';
    }
    
    // Event listeners
    searchInput.addEventListener('input', filterRestorations);
    modelFilter.addEventListener('change', filterRestorations);
    sortFilter.addEventListener('change', filterRestorations);
    
    clearSearch.addEventListener('click', () => {
        searchInput.value = '';
        filterRestorations();
    });
    
    // Clear history button
    document.getElementById('clearHistory').addEventListener('click', function() {
        if (confirm('Are you sure you want to clear your restoration history? This action cannot be undone.')) {
            const cards = document.querySelectorAll('.restoration-card');
            cards.forEach(card => card.remove());
            emptyState.style.display = 'block';
            updateStats();
            alert('History cleared successfully!');
        }
    });
    
    // Pagination
    const prevPage = document.getElementById('prevPage');
    const nextPage = document.getElementById('nextPage');
    const pageNumbers = document.querySelectorAll('.page-number');
    
    pageNumbers.forEach(page => {
        page.addEventListener('click', function() {
            pageNumbers.forEach(p => p.classList.remove('active'));
            this.classList.add('active');
            
            // Update button states
            const currentPage = parseInt(this.textContent);
            prevPage.disabled = currentPage === 1;
            nextPage.disabled = currentPage === 5; // Assuming 5 pages total
        });
    });
    
    prevPage.addEventListener('click', function() {
        const activePage = document.querySelector('.page-number.active');
        const currentPage = parseInt(activePage.textContent);
        
        if (currentPage > 1) {
            pageNumbers.forEach(p => p.classList.remove('active'));
            pageNumbers[currentPage - 2].classList.add('active');
            
            prevPage.disabled = currentPage - 1 === 1;
            nextPage.disabled = false;
        }
    });
    
    nextPage.addEventListener('click', function() {
        const activePage = document.querySelector('.page-number.active');
        const currentPage = parseInt(activePage.textContent);
        
        if (currentPage < 5) { // Assuming 5 pages total
            pageNumbers.forEach(p => p.classList.remove('active'));
            pageNumbers[currentPage].classList.add('active');
            
            prevPage.disabled = false;
            nextPage.disabled = currentPage + 1 === 5;
        }
    });
    
    // Initialize
    updateStats();
    filterRestorations();
});

// Card action functions
function downloadRestoration(button) {
    const card = button.closest('.restoration-card');
    const title = card.querySelector('.card-title').textContent;
    
    const originalText = button.innerHTML;
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Downloading...';
    button.disabled = true;
    
    setTimeout(() => {
        alert(`Downloading restoration: ${title}\n\nIn a real implementation, this would trigger a file download.`);
        button.innerHTML = originalText;
        button.disabled = false;
    }, 1500);
}

function viewRestoration(button) {
    const card = button.closest('.restoration-card');
    const title = card.querySelector('.card-title').textContent;
    
    alert(`Viewing details for: ${title}\n\nThis would navigate to a detailed view page in a full implementation.`);
}

function exportHistory() {
    const exportBtn = document.querySelector('[onclick="exportHistory()"]');
    const originalText = exportBtn.innerHTML;
    
    exportBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Exporting...';
    exportBtn.disabled = true;
    
    setTimeout(() => {
        alert('History export started! In a real implementation, this would generate and download a CSV/JSON file with your restoration history.');
        exportBtn.innerHTML = originalText;
        exportBtn.disabled = false;
    }, 2000);
}
</script>
{% endblock %}
